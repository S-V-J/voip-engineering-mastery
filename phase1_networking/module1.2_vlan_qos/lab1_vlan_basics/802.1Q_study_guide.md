# 802.1Q VLAN Tagging - Deep Dive Study Guide
**Study Date:** February 5, 2026
**Duration:** 2 hours
**Objective:** Master 802.1Q frame structure and VLAN concepts

---

## Part 1: Ethernet Frame Evolution (30 minutes)

### Standard Ethernet Frame (No VLAN)
```
┌─────────────────────────────────────────────────────────────────┐
│  7 bytes  │ 1  │  6 bytes │  6 bytes │ 2  │  46-1500  │ 4 bytes │
│ Preamble  │SFD │ Dest MAC │ Src MAC  │Type│  Payload  │   FCS   │
└─────────────────────────────────────────────────────────────────┘
Total: 64-1518 bytes
```

### 802.1Q Tagged Frame (With VLAN)
```
┌──────────────────────────────────────────────────────────────────────┐
│  7  │ 1 │  6  │  6  │     4 bytes     │ 2  │ 46-1500 │ 4 bytes │
│Preamble│SFD│ DMAC│ SMAC│ 802.1Q Tag │Type│ Payload │   FCS   │
└──────────────────────────────────────────────────────────────────────┘
Total: 68-1522 bytes (4 bytes larger!)
```

**Key Difference:** 802.1Q adds 4-byte tag between Source MAC and EtherType

---

## Part 2: 802.1Q Tag Breakdown (45 minutes)

### The 4-Byte VLAN Tag Structure

```
┌────────────────┬─────────┬─────┬─────────────────────┐
│ TPID (16 bits) │ PCP (3) │ DEI │  VLAN ID (12 bits)  │
│     0x8100     │  0-7    │ 0/1 │      1-4094         │
└────────────────┴─────────┴─────┴─────────────────────┘
    2 bytes                    2 bytes
```

### Field Descriptions:

**1. TPID (Tag Protocol Identifier) - 16 bits**
- **Value:** Always `0x8100` for 802.1Q
- **Purpose:** Tells receiver "this frame has a VLAN tag"
- **Binary:** `1000 0001 0000 0000`
- **Location:** Immediately after Source MAC address

**2. PCP (Priority Code Point) - 3 bits**
- **Values:** 0-7 (8 priority levels)
- **Purpose:** Layer 2 QoS priority (CoS)
- **VoIP Usage:** Priority 5 for voice traffic

| PCP | Priority | Traffic Type |
|-----|----------|--------------|
| 0   | Best Effort (default) | Normal data |
| 1   | Background | Bulk transfers |
| 2   | Excellent Effort | Business-critical |
| 3   | Critical Applications | Streaming video |
| 4   | Video | <100ms latency |
| **5** | **Voice** | **<10ms latency (VoIP)** |
| 6   | Internetwork Control | Routing protocols |
| 7   | Network Control | Highest priority |

**3. DEI (Drop Eligible Indicator) - 1 bit**
- **Values:** 0 or 1
- **Purpose:** Mark frame as droppable during congestion
- **0:** Keep frame (high priority)
- **1:** Can drop if network congested
- **VoIP Usage:** Always 0 (never drop voice frames)

**4. VLAN ID (VID) - 12 bits**
- **Range:** 0-4095 (2^12 = 4096 values)
- **Usable:** 1-4094 (4094 VLANs)
- **Reserved:**
  - `0`: Priority tagging (no VLAN)
  - `1`: Default VLAN (often avoided for security)
  - `4095`: Reserved
- **VoIP Standard:** VLAN 10 for voice, VLAN 20 for data

---

## Part 3: Binary Example (30 minutes)

### Example: Voice VLAN 10 with Priority 5

**Configuration:**
- VLAN ID: 10
- Priority (PCP): 5
- DEI: 0

**Step 1: Convert VLAN ID 10 to binary**
```
10 decimal = 000000001010 binary (12 bits)
```

**Step 2: Build TCI (Tag Control Information) - 16 bits**
```
┌─────────┬─────┬──────────────┐
│ PCP (3) │ DEI │  VLAN ID(12) │
│   101   │  0  │ 000000001010 │
└─────────┴─────┴──────────────┘
   5       0         10

Combined: 1010 0000 0000 1010
Hex: 0xA00A
```

**Step 3: Complete 802.1Q Tag (4 bytes)**
```
TPID: 0x8100
TCI:  0xA00A

Full tag: 0x8100A00A
```

**Wireshark Display:**
```
Ethernet II, Src: 00:11:22:33:44:55, Dst: 66:77:88:99:aa:bb
    802.1Q Virtual LAN, PRI: 5, DEI: 0, ID: 10
        1000 .... .... .... = TPID: 0x8100
        .... 101. .... .... = Priority: 5
        .... ...0 .... .... = DEI: 0
        .... .... 0000 1010 = ID: 10
```

---

## Part 4: Access vs Trunk Ports (15 minutes)

| Feature | Access Port | Trunk Port |
|---------|-------------|------------|
| **Connects to** | End device (PC, phone) | Another switch |
| **VLAN tagging** | Removed before sending to device | Tags preserved |
| **VLANs allowed** | One VLAN only | Multiple VLANs |
| **Frame handling** | Untagged to device | Tagged (802.1Q) |
| **Configuration** | `switchport mode access` | `switchport mode trunk` |

**Voice VLAN Exception:**
- IP phones have built-in switches
- Access port can carry TWO VLANs:
  - Data VLAN (untagged) for PC
  - Voice VLAN (tagged) for phone
- Command: `switchport voice vlan 10`

---

## Study Exercises

### Exercise 1: Calculate TCI Value
Given: VLAN 20, Priority 0, DEI 0
1. VLAN 20 in 12-bit binary: _______________
2. PCP 0 in 3-bit binary: _______________
3. DEI: _______________
4. TCI in hex: _______________

<details>
<summary>Answer</summary>

1. 000000010100
2. 000
3. 0
4. 0x0014
</details>

### Exercise 2: Decode TCI
Given TCI: 0xA014
1. What is the VLAN ID? _______________
2. What is the priority? _______________
3. Is DEI set? _______________
4. What traffic type is this? _______________

<details>
<summary>Answer</summary>

1. VLAN 20
2. Priority 5
3. No (DEI = 0)
4. Voice traffic (PCP=5, likely VoIP)
</details>

---

## Study Checklist
- [ ] Understand why 802.1Q adds 4 bytes to frame
- [ ] Memorize TPID value (0x8100)
- [ ] Know PCP values 0-7 and priority meanings
- [ ] Understand PCP 5 is for VoIP
- [ ] Know VLAN ID range (1-4094)
- [ ] Can calculate TCI from VLAN ID and priority
- [ ] Understand access vs trunk port differences
- [ ] Know how voice VLAN works on access ports

**Study Time:** Record actual time spent: _____ hours